# Financial Analytics System

Система финансовой аналитики на базе Strapi CMS с автоматическими расчетами финансовых показателей.

## Описание проекта

Данная система предназначена для управления финансовыми данными компаний с автоматическим расчетом ключевых финансовых показателей. Система построена на базе Strapi CMS и использует PostgreSQL в качестве базы данных.

## Функциональность и особенности

- Управление данными компаний
- Ввод и хранение финансовых данных
- Автоматический расчет финансовых показателей с использованием lifecycle hooks
- Поддержка загрузки финансовых данных
- Многоязычность (i18n)

### Автоматические расчеты

Система автоматически рассчитывает следующие финансовые показатели:

#### P&L расчеты:
- Валовая прибыль (Gross Margin) = Выручка - Себестоимость
- Операционная прибыль (Operating Profit) = Валовая прибыль - Накладные расходы
- Прибыль до налогообложения (Net Profit Before Tax) = Операционная прибыль - Проценты по кредитам - Чрезвычайные расходы
- Чистая прибыль (Net Profit) = Прибыль до налогообложения - Налоги
- Нераспределенная прибыль (Retained Profit) = Чистая прибыль - Выплаченные дивиденды
- EBITDA = Операционная прибыль + Амортизация

#### Balance Sheet расчеты:
- Оборотные активы (Current Assets) = Денежные средства + Дебиторская задолженность + Запасы + Прочие оборотные активы
- Внеоборотные активы (Non-Current Assets) = Основные средства + Прочие внеоборотные активы
- Общие активы (Total Assets) = Оборотные активы + Внеоборотные активы
- Краткосрочные обязательства (Current Liabilities) = Кредиторская задолженность + Краткосрочные кредиты + Прочие краткосрочные обязательства
- Долгосрочные обязательства (Non-Current Liabilities) = Долгосрочные кредиты + Прочие долгосрочные обязательства
- Общие обязательства (Total Liabilities) = Краткосрочные обязательства + Долгосрочные обязательства

## Установка и запуск

### Предварительные требования

- Docker и Docker Compose
- Node.js (для локальной разработки)

### Запуск с использованием Docker

1. Клонировать репозиторий:
```bash
git clone https://github.com/leval907/financial-analytics-system.git
cd financial-analytics-system
```

2. Запустить контейнеры:
```bash
cd docker/strapi
docker-compose up -d
```

3. Открыть админ-панель Strapi:
```
http://localhost:1337/admin
```

## Структура проекта

```
docker/
├── nuxt-app/                # Frontend на Nuxt.js
│   ├── app.vue
│   ├── nuxt.config.ts
│   └── ...
└── strapi/                  # Backend на Strapi
    ├── strapi-v4/           # Код Strapi
    │   ├── config/          # Конфигурация Strapi
    │   ├── src/             # Исходный код
    │   │   ├── api/         # API и модели
    │   │   │   ├── company/ # API компаний
    │   │   │   ├── financial-data/ # API финансовых данных
    │   │   │   │   └── content-types/financial-data/lifecycles.js # Lifecycle hooks для расчетов
    │   │   │   └── financial-upload/ # API загрузки финансовых данных
    │   │   └── ...
    │   └── ...
    ├── docker-compose.yml   # Конфигурация Docker Compose
    └── ...
```

## Lifecycle Hooks

Система использует lifecycle hooks Strapi для автоматического расчета финансовых показателей при создании или обновлении финансовых данных. Код расчетов находится в файле `docker/strapi/strapi-v4/src/api/financial-data/content-types/financial-data/lifecycles.js`.

Расчеты выполняются в функции `calculateFields`, которая вызывается перед созданием и обновлением записей в таблице financial_datas.

## Разработка

### Модификация расчетов

Для изменения логики расчетов финансовых показателей необходимо отредактировать файл `docker/strapi/strapi-v4/src/api/financial-data/content-types/financial-data/lifecycles.js`.

### Добавление новых полей

Для добавления новых полей в модель финансовых данных необходимо:

1. Добавить новые поля в схему модели `docker/strapi/strapi-v4/src/api/financial-data/content-types/financial-data/schema.json`
2. Обновить логику расчетов в файле `docker/strapi/strapi-v4/src/api/financial-data/content-types/financial-data/lifecycles.js`
3. Перезапустить Strapi

## Лицензия

MIT